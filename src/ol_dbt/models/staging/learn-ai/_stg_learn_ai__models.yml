---
version: 2

models:
- name: stg__learn_ai__app__postgres__users_user
  description: Learn AI user information
  columns:
  - name: user_id
    description: int, primary key in users_user
    tests:
    - not_null
    - unique
  - name: user_global_id
    description: str, global SSO ID for the user across all platforms.
  - name: user_username
    description: str, username of the user.
    tests:
    - not_null
    - unique
  - name: user_full_name
    description: str, name of the user.
    tests:
    - not_null
  - name: user_email
    description: str, email address of the user.
    tests:
    - not_null
  - name: user_last_login
    description: timestamp, date and time of the user's last login.
  - name: user_is_staff
    description: boolean, indicates if the user is a staff member.
    tests:
    - not_null
  - name: user_is_superuser
    description: boolean, used for django admin access.
    tests:
    - not_null
  - name: user_is_active
    description: bool, indicates if the user account is active.
    tests:
    - not_null
  - name: user_created_on
    description: timestamp, date and time when the record was created.
    tests:
    - not_null
  - name: user_updated_on
    description: timestamp, date and time when the record was last updated.
    tests:
    - not_null

- name: stg__learn_ai__app__postgres__chatbots_userchatsession
  description: Learn AI chat session associate LangGraph threads with users
  columns:
  - name: chatsession_id
    description: int, primary key in ai_chatbots_userchatsession.
    tests:
    - not_null
    - unique
  - name: chatsession_thread_id
    description: str, unique identifier for the chat thread.
    tests:
    - not_null
    - unique
  - name: chatsession_agent
    description: str, indicates the type of chatbot agent used in the session. Possible
      values - TutorBot, ResourceRecommendationBot, VideoGPTBot, SyllabusBot
  - name: chatsession_title
    description: str, the initial question of the chat session.
  - name: user_id
    description: id, foreign key to auth_user in learn AI application. Null if the
      user is not logged in.
  - name: chatsession_object_id
    description: str, course ID, video transcript asset ID, or edX module ID depending
      on the chatsession_agent. May be blank for ResourceRecommendationBot.
  - name: canvas_course_id
    description: str, Canvas course ID for the chat session, e.g. 34625-15.060_FA25
      May be blank for non-Canvas
  - name: chatsession_django_session_key
    description: str, Django session key for the chat session.
  - name: chatsession_created_on
    description: timestamp, date and time when the record was created.
    tests:
    - not_null
  - name: chatsession_updated_on
    description: timestamp, date and time when the record was last updated.
    tests:
    - not_null

- name: stg__learn_ai__app__postgres__chatbots_djangocheckpoint
  description: Chatbot messages for RecommendationBot, SyllabusBot and VideoGPTBot
  columns:
  - name: djangocheckpoint_id
    description: int, primary key in chatbots_djangocheckpoint
    tests:
    - not_null
    - unique
  - name: checkpoint_type
    description: str, type of the checkpoint, e.g. msgpack
  - name: chatsession_id
    description: int, foreign key to chatbots_userchatsession
  - name: chatsession_thread_id
    description: str, unique identifier for the chat thread.
    tests:
    - not_null
  - name: checkpoint_json
    description: json, the checkpoint json object for the chat session. It contains
      the entire session chat history
  - name: checkpoint_namespace
    description: str, checkpoint namespace, used to group checkpoints in a thread.
  - name: checkpoint_id
    description: str, unique identifier for the checkpoint.
    tests:
    - not_null
  - name: parent_checkpoint_id
    description: str, checkpoint ID of the parent checkpoint. Null if this is the
      first checkpoint in the thread.
  - name: checkpoint_metadata
    description: json, the metadata for the checkpoint
  - name: human_message
    description: str, the human message extracted from the metadata.
  - name: agent_message
    description: str, the agent message extracted from the metadata.
  - name: checkpoint_step
    description: int, the step number of the checkpoint in the chat session extracted
      from the metadata.
    tests:
    - not_null
  - name: checkpoint_source
    description: str, the source of the checkpoint extracted from the metadata. e.g.
      'input', 'loop'
  - name: checkpoint_created_on
    data_type: timestamp
    description: date and time when the checkpoint was created.
  - name: checkpoint_updated_on
    data_type: timestamp
    description: date and time when the checkpoint was last updated.

  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["checkpoint_namespace", "chatsession_thread_id", "checkpoint_id"]

- name: stg__learn_ai__app__postgres__chatbots_tutorbotoutput
  description: TutorBot chat history
  columns:
  - name: tutorbotoutput_id
    description: int, primary key in ai_chatbots_tutorbotoutput
    tests:
    - not_null
    - unique
  - name: chatsession_thread_id
    description: str, unique identifier for the chat thread.
    tests:
    - not_null
  - name: tutorbot_chat_json
    description: json string, the chat history and internal state of the TutorBot.

- name: stg__learn_ai__app__postgres__chatbots_chatresponserating
  description: User ratings for AI chatbot responses
  columns:
  - name: djangocheckpoint_id
    data_type: integer
    description: foreign key to ai_chatbots_djangocheckpoint.
  - name: rating
    data_type: varchar
    description: user rating for the chatbot response. E.g., like, dislike, '' for
      no rating.
  - name: rating_reason
    data_type: varchar
    description: user provided reason for the rating.
  - name: rating_created_on
    data_type: timestamp
    description: date and time when the rating was created.
  - name: rating_updated_on
    data_type: timestamp
    description: date and time when the rating was last updated.
