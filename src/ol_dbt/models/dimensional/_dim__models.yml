---
version: 2

models:
- name: dim_platform
  description: Platform information about the technical system that a given event
    is executed within the context of.
  columns:
  - name: platform_id
    description: string, primary key for this table
    tests:
    - not_null
    - unique
  - name: platform_name
    description: string, name of the platform
    tests:
    - not_null
    - unique
  - name: platform_description
    description: string, description of the platform
    tests:
    - not_null
  - name: platform_domain
    description: string, domain name of the platform, e.g. mitxonline.mit.edu
    tests:
    - not_null

- name: dim_course_content
  description: Slowly Changing Dimension model for course content, including courses,
    chapters, subsections, problems, videos, and other contents across the Open edX
    platforms.
  columns:
  - name: content_id
    description: string, primary key for this table
    tests:
    - not_null
    - unique
  - name: courserun_readable_id
    description: string, the edX course ID formatted as course-v1:{org}+{course code}+{run_tag}
      for courses on MITxOnline, xPro and Residential platform, {org}/{course}/{run_tag}
      for edX.org courses
    tests:
    - not_null
  - name: block_index
    description: int, sequence number giving order in which this block content appears
      within the course
    tests:
    - not_null
  - name: block_id
    description: string, a unique identifier for each content block within the course,
      formatted as block-v1:{org}+{course}+{run}type@{block type}+block@{hash code}
    tests:
    - not_null
  - name: parent_block_id
    description: string, parent content block ID, same format as content_block_id.
  - name: block_category
    description: string, category/type of the content block. Possible values are course,
      chapter, sequential, vertical, discussion, html, problem, video, etc.
    tests:
    - not_null
  - name: block_title
    description: string, title of the course content block. It is the name field for
      the section, subsection, or unit on the Studio 'Course Outline' page.
  - name: block_metadata
    description: string, a JSON string representing the metadata field of the course
      content block. It provides additional information about this block, and different
      block types may have different member fields within the metadata.
    tests:
    - not_null
  - name: retrieved_at
    description: timestamp, date and time indicating when the content block was last
      retrieved from sources.
    tests:
    - not_null
  - name: is_latest
    description: boolean, indicating if the course content is the latest version
    tests:
    - not_null

- name: tfact_course_navigation_events
  description: Transactional fact table for learner navigation events in a course
  columns:
  - name: user_id
    description: string, foreign key to dim_user, referencing the user who navigated
      the course
    tests:
    - not_null
  - name: platform_id
    description: string, foreign key to dim_platform, referencing the platform where
      the navigation event occurred
    tests:
    - not_null
  - name: courserun_readable_id
    description: string, foreign key to dim_course_content, referencing the edX course
      run ID
    tests:
    - not_null
  - name: event_type
    description: string, type of the navigation event, e.g. edx.ui.lms.jump_nav.selected,
      edx.ui.lms.link_clicked, edx.ui.lms.outline.selected, edx.ui.lms.sequence.next_selected,
      edx.ui.lms.sequence.previous_selected, edx.ui.lms.sequence.tab_selected, edx.ui.lms.video.played
    tests:
    - not_null
  - name: block_id
    description: string, foreign key to dim_course_content, referencing the block
      ID of the subsection that is being navigated by the user. Populated only for
      events that are related to course subsections.
  - name: starting_position
    description: string, the starting position where the user is navigating from,
      either a page URL or the tab in the unit navigation bar.
  - name: ending_position
    description: string, the ending position where the user is navigating to, either
      a page URL or the tab in the unit navigation bar. If ending_position is NULL
      but starting_position is not NULL, it means the user navigates from the first
      unit in one subsection to the last unit in the previous subsection using the
      "previous" control, or from the last unit in one subsection to the first unit
      in the next subsection using the "next" control.
  - name: event_timestamp
    description: timestamp, timestamp (with time zone) indicating the time at which
      the event occurred, formatted as timestamp(9)
    tests:
    - not_null
  - name: event_json
    description: json, it includes member fields that identify specifics of each triggered
      event. For less common/event-specific attributes.

- name: tfact_video_events
  description: Transactional fact table for learner video events in a course
  columns:
  - name: user_id
    description: string, foreign key to dim_user, referencing the user who interacted
      with the video
    tests:
    - not_null
  - name: platform_id
    description: string, foreign key to dim_platform, referencing the platform where
      the video event occurred
    tests:
    - not_null
  - name: courserun_readable_id
    description: string, foreign key to dim_course_content, referencing the edX course
      run ID
    tests:
    - not_null
  - name: event_type
    description: string, type of the video event. Possible values are load_video,
      pause_video, play_video, seek_video, speed_change_video, stop_video, and video_hide_transcript.
    tests:
    - not_null
  - name: video_id
    description: string, foreign key referencing a substring of the video block ID
      in the dim_course_content table.
    tests:
    - not_null
  - name: video_duration
    description: float, the length of the video, in seconds.
  - name: video_position
    description: number, the seconds into the video where the event occurred. May
      be Null for `load_video` or `seek_video` events.
  - name: starting_position
    description: number, the seconds into the video where the user was before seeking
      the video. For very small seek_video events, the `old_time` may not be recorded
      in the residential dataset.
  - name: ending_position
    description: number, the seconds into the video where the user was after seeking
      the video.
    tests:
    - dbt_expectations.expect_column_values_to_not_be_null:
        row_condition: "event_type = 'seek_video'"
  - name: event_timestamp
    description: timestamp, timestamp (with time zone) indicating the time at which
      the event occurred, formatted as timestamp(9)
    tests:
    - not_null
  - name: event_json
    description: json, it includes member fields that identify specifics of each triggered
      event. For less common/event-specific attributes.

- name: tfact_problem_events
  description: Transactional fact table for learner problem events in a course
  columns:
  - name: user_id
    description: string, foreign key to dim_user, referencing the user who interacted
      with the problem
    tests:
    - not_null
  - name: platform_id
    description: string, foreign key to dim_platform, referencing the platform where
      the problem event occurred
    tests:
    - not_null
  - name: courserun_readable_id
    description: string, foreign key to dim_course_content, referencing the edX course
      run ID
    tests:
    - not_null
  - name: event_type
    description: string, type of the problem event. Possible values are problem_check,
      , showanswer
    tests:
    - not_null
  - name: problem_id
    description: string, foreign key referencing the problem block ID in the dim_course_content
      table.
    tests:
    - not_null
  - name: attempt
    description: number, number indicating which attempt this was
  - name: answers
    description: json, student answers to this problem in problem_id and internal
      answer pair. For multiple questions, it lists every question and answer.
  - name: success
    description: str, It's either 'correct' or 'incorrect'
  - name: current_grade
    description: number, current grade value
  - name: max_grade
    description: number, maximum possible grade value for the problem
  - name: event_timestamp
    description: timestamp, timestamp (with time zone) indicating the time at which
      the event occurred, formatted as timestamp(9)
    tests:
    - not_null
  - name: event_json
    description: json, it includes member fields that identify specifics of each triggered
      event. For less common/event-specific attributes.
