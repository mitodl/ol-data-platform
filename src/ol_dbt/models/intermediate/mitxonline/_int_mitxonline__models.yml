---
version: 2

models:
- name: int__mitxonline__enrollments
  description: Intermediate model of enrollments in MITx Online.
  columns:
  - name: id
    description: id for enrollment
    tests:
    - not_null
  - name: course_run_active
    description: boolean specifying whether the user is active in this course run
  - name: user_id
    description: id for the enrolling user
  - name: created_on
    description: timestamp specifying when the enrollment happened
  - name: courserun_url
    description: url for course where the user is enrolled
  - name: course_title
    description: title of the course where the user is enrolled
  - name: user_username
    description: str, name chosen by user
  - name: user_email
    description: str, email associated with the user account

- name: int__mitxonline__course_runs
  description: ""
  columns:
  - name: courserun_id
    description: int, primary key representing a single MITx Online course run
  - name: courserun_title
    description: str, title of the course run
  - name: courserun_end_on
    description: timestamp, specifying when the course ends
  - name: courserun_start_on
    description: timestamp, specifying when the course begins
  - name: courserun_readable_id
    description: str, Open edX Course ID formatted as course-v1:{org}+{course code}+{run_tag}
  - name: courserun_url
    description: str, url location for the course run in MITx Online

- name: int__mitxonline__users
  description: denormalized mitxonline users
  columns:
  - name: user_id
    description: int, primary key
    tests:
    - unique
    - not_null
    - dbt_expectations.expect_column_to_exist
  - name: user_username
    description: string, username
    tests:
    - unique
    - not_null
    - dbt_expectations.expect_column_to_exist
  - name: user_full_name
    description: string, full name
    tests:
    - not_null
    - dbt_expectations.expect_column_to_exist
  - name: user_email
    description: string, email
    tests:
    - unique
    - not_null
    - dbt_expectations.expect_column_to_exist
  - name: user_joined_on
    description: timestamp, user join timestamp
    tests:
    - dbt_expectations.expect_column_to_exist
  - name: user_last_login
    description: timestamp, user last log in
    tests:
    - dbt_expectations.expect_column_to_exist
  - name: user_address_country
    description: string, country code for the user's address
    tests:
    - dbt_expectations.expect_column_to_exist
  tests:
  - dbt_expectations.expect_table_column_count_to_equal:
      value: 7
  - dbt_expectations.expect_table_row_count_to_equal_other_table:
      compare_model: ref('stg__mitxonline__app__postgres__users_user')
      compare_row_condition: "user_is_active = true"
