---
version: 2

models:
- name: __micromasters__users
  description: MicroMasters users according to the micromasters database. Does not
    include users who have a login on mitxonline only
  columns:
  - name: user_id
    description: int, sequential ID representing a user in MicroMasters
    tests:
    - unique
    - not_null
  - name: user_username
    description: str, unique string to identify user
    tests:
    - unique
    - not_null
  - name: user_full_name
    description: str, user's full name
  - name: user_email
    description: str, user email associated with user account (not unique)
    tests:
    - not_null
  - name: user_joined_on
    description: timestamp, specifying when a user account was initially created
  - name: user_last_login
    description: timestamp, specifying when a user last logged in
  - name: user_address_country
    description: str, country code for the user's address
  - name: user_is_active
    description: boolean, indicating if user is active or not
  - name: user_mitxonline_username
    description: str, username in mitxonline
  - name: user_edxorg_username
    description: str, username in edx.org. For the very small number of users with
      multiple edx usernames, this is the username with the latest logins
  tests:
  - dbt_expectations.expect_table_row_count_to_equal_other_table:
      compare_model: ref('stg__micromasters__app__postgres__auth_user')
- name: __micromasters_program_certificates_dedp_from_micromasters
  description: DEDP program certificate earners according to the micromasters database
  columns:
  - name: user_edxorg_username
    description: str, The username of the learner on the edX platform
    tests:
    - not_null
  - name: user_mitxonline_username
    description: str, username on MITx Online
  - name: user_email
    description: str, The email address of the learner on the edX platform
    tests:
    - not_null
  - name: micromasters_program_id
    description: int, sequential ID representing a program in MicroMasters
    tests:
    - not_null
  - name: program_title
    description: str, title of the program
    tests:
    - not_null
  - name: user_edxorg_id
    description: int, Numerical user ID of a learner on the edX platform
  - name: user_gender
    description: str, user's gender from edxorg - blank means user did not specify
      a gender. Null means this student signed up before this information was collected
    tests:
    - accepted_values:
        values: ['Male', 'Female', 'Other/Prefer Not to Say', '', null]
  - name: user_country
    description: str, Country provided by the user on the edX platform
  - name: user_address_city
    description: str, city where user lives in, collected from the micromasters database
  - name: user_first_name
    description: str, first from the micromasters profile
  - name: user_last_name
    description: str, last name from the micromasters profile
  - name: user_year_of_birth
    description: str, user's birth year from the profile in the micromasters database
  - name: user_address_postal_code
    description: str, postal code where user lives in from the profile in micromasters
  - name: user_street_address
    description: str, street address where user lives in from the profile in the micromasters
      database
  - name: user_address_state_or_territory
    description: str,  state or territory where user lives in from the profile in
      the micromasters database
  - name: user_full_name
    description: str, The full name of the user on the edX platform
  - name: program_completion_timestamp
    description: timestamp, timestamp of the course certificate that completed the
      program
    tests:
    - not_null
  - name: micromasters_user_id
    description: str, user id in the micromasters database

- name: __micromasters_program_certificates_dedp_from_mitxonline
  description: DEDP program certificate earners according to the mitxonline database
  columns:
  - name: user_edxorg_username
    description: str, The username of the learner on the edX platform
  - name: user_mitxonline_username
    description: str, username on MITx Online
    tests:
    - not_null
  - name: user_email
    description: str, The email address of the learner on the edX platform
    tests:
    - not_null
  - name: micromasters_program_id
    description: int, sequential ID representing a program in MicroMasters
    tests:
    - not_null
  - name: program_title
    description: str, title of the program
    tests:
    - not_null
  - name: user_edxorg_id
    description: int, Numerical user ID of a learner on the edX platform
  - name: user_gender
    description: str, user's gender from edxorg - blank means user did not specify
      a gender. Null means this student signed up before this information was collected
    tests:
    - accepted_values:
        values: ['Male', 'Female', 'Other/Prefer Not to Say', '', null]
  - name: user_country
    description: str, Country provided by the user on the edX platform
  - name: user_address_city
    description: str, city where user lives in, collected from the micromasters database
  - name: user_first_name
    description: str, first from the micromasters profile
  - name: user_last_name
    description: str, last name from the micromasters profile
  - name: user_year_of_birth
    description: str, user's birth year from the profile in the micromasters database
  - name: user_address_postal_code
    description: str, postal code where user lives in from the profile in micromasters
  - name: user_street_address
    description: str, street address where user lives in from the profile in the micromasters
      database
  - name: user_address_state_or_territory
    description: str,  state or territory where user lives in from the profile in
      the micromasters database
  - name: user_full_name
    description: str, The full name of the user on the edX platform
  - name: program_completion_timestamp
    description: timestamp, timestamp of the course certificate that completed the
      program
    tests:
    - not_null
  - name: micromasters_user_id
    description: str, user id in the micromasters database

- name: __micromasters_program_certificates_non_dedp
  description: Non DEDP program certificate earners. Calculated from joining edxorg
    course certificate records to the program requirements from the micromasters database
  columns:
  - name: user_edxorg_username
    description: str, The username of the learner on the edX platform
    tests:
    - not_null
  - name: user_mitxonline_username
    description: str, username on MITx Online
  - name: user_email
    description: str, The email address of the learner on the edX platform
    tests:
    - not_null
  - name: micromasters_program_id
    description: int, sequential ID representing a program in MicroMasters
    tests:
    - not_null
  - name: program_title
    description: str, title of the program
    tests:
    - not_null
  - name: user_edxorg_id
    description: int, Numerical user ID of a learner on the edX platform
    tests:
    - not_null
  - name: user_gender
    description: str, user's gender from edxorg - blank means user did not specify
      a gender. Null means this student signed up before this information was collected
    tests:
    - accepted_values:
        values: ['Male', 'Female', 'Other/Prefer Not to Say', '', null]
  - name: user_country
    description: str, Country provided by the user on the edX platform
  - name: user_address_city
    description: str, city where user lives in, collected from the micromasters database
  - name: user_first_name
    description: str, first from the micromasters profile
  - name: user_last_name
    description: str, last name from the micromasters profile
  - name: user_year_of_birth
    description: str, user's birth year from the profile in the micromasters database
  - name: user_address_postal_code
    description: str, postal code where user lives in from the profile in micromasters
  - name: user_street_address
    description: str, street address where user lives in from the profile in the micromasters
      database
  - name: user_address_state_or_territory
    description: str,  state or territory where user lives in from the profile in
      the micromasters database
  - name: user_full_name
    description: str, The full name of the user on the edX platform
  - name: program_completion_timestamp
    description: timestamp, timestamp of the course certificate that completed the
      program
  - name: micromasters_user_id
    description: str, user id in the micromasters database

- name: __micromasters_course_certificates_dedp_from_micromasters
  description: DEDP course certificates from MicroMasters database
  columns:
  - name: program_title
    description: str, title of program the course is part of
    tests:
    - not_null
  - name: micromasters_program_id
    description: str, id of program the course is part of in the micromasters database
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run ID from MicroMasters database
    tests:
    - not_null
  - name: courserun_edxorg_readable_id
    description: str, courserun_readable_id formatted as {org}/{course code}/{run_tag}
      to match course in edxorg
    tests:
    - not_null
  - name: courserun_platform
    description: str, indicating the platform where this course runs on. It's either
      mitxonline or edxorg
    tests:
    - not_null
  - name: course_number
    description: str, unique string for the course e.g. 14.009x
    tests:
    - not_null
  - name: user_edxorg_username
    description: str, username on edX.org
  - name: user_mitxonline_username
    description: str, username on MITxOnline
  - name: user_email
    description: str, user email on edX.org
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on edX.org
  - name: user_country
    description: str, user country on edX.org
  - name: coursecertificate_hash
    description: str, unique hash used to identify this DEDP course certificate
    tests:
    - unique
    - not_null
  - name: coursecertificate_url
    description: str, the full URL to this DEDP course certificate on MicroMasters
    tests:
    - unique
    - not_null
  - name: coursecertificate_created_on
    description: timestamp, date and time when DEDP course certificate was initially
      created on MicroMasters
    tests:
    - not_null
  - name: coursecertificate_updated_on
    description: timestamp, date and time when DEDP course certificate was most recently
      updated on MicroMasters
    tests:
    - not_null
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_email", "courserun_readable_id"]
  - dbt_expectations.expect_table_row_count_to_equal_other_table:
      compare_model: ref('stg__micromasters__app__postgres__grades_coursecertificate')

- name: __micromasters_course_certificates_dedp_from_mitxonline
  description: DEDP course certificates earned (excluded revoked) on MITxOnline
  columns:
  - name: program_title
    description: str, title of program the course is part of
    tests:
    - not_null
  - name: micromasters_program_id
    description: str, id of program the course is part of in the micromasters database
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run ID on MITx Online
    tests:
    - not_null
  - name: courserun_platform
    description: str, indicating the platform where this course runs on. It's either
      mitxonline or edxorg. edxorg runs were migrated from MicroMasters.
    tests:
    - not_null
  - name: course_number
    description: str, unique string for the course e.g. 14.009x
    tests:
    - not_null
  - name: user_edxorg_username
    description: str, username on edX.org
  - name: user_mitxonline_username
    description: str, username on MITxOnline
    tests:
    - not_null
  - name: user_email
    description: str, user email on MITx Online
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on MITx Online
  - name: user_country
    description: str, user country on MITx Online
  - name: courseruncertificate_uuid
    description: str, unique identifier for the certificate on MITx Online
    tests:
    - unique
    - not_null
  - name: courseruncertificate_url
    description: str, the full URL to this DEDP course certificate on MITx Online
    tests:
    - unique
    - not_null
  - name: courseruncertificate_created_on
    description: timestamp, date and time when DEDP course certificate was initially
      created on MITx Online
    tests:
    - not_null
  - name: courseruncertificate_updated_on
    description: timestamp, date and time when DEDP course certificate was most recently
      updated
    tests:
    - not_null
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_mitxonline_username", "courserun_readable_id"]

- name: __micromasters_course_certificates_non_dedp_from_edxorg
  description: Non-DEDP program course certificates earned on edX.org
  columns:
  - name: program_title
    description: str, title of program the course is part of
    tests:
    - not_null
  - name: micromasters_program_id
    description: str, id of program the course is part of in the micromasters database
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run ID on edX.org
    tests:
    - not_null
  - name: courserun_platform
    description: str, indicating the edx.org platform where this course runs on
    tests:
    - not_null
  - name: course_number
    description: str, unique string for the course e.g. 14.009x
    tests:
    - not_null
  - name: user_edxorg_username
    description: str, username on edX.org
    tests:
    - not_null
  - name: user_mitxonline_username
    description: str, username on MITxOnline
  - name: user_email
    description: str, user email on edX.org
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on edX.org
  - name: user_country
    description: str, user country on edX.org
  - name: courseruncertificate_download_url
    description: str, the full URL to the certificate
  - name: courseruncertificate_download_uuid
    description: str, A hash code that identifies this student’s certificate. Included
      as part of the download_url.
  - name: courseruncertificate_created_on
    description: timestamp, date and time when this course certificate was initially
      created on edX.org
    tests:
    - not_null
  - name: courseruncertificate_updated_on
    description: timestamp, date and time when this course certificate was most recently
      updated
    tests:
    - not_null
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_edxorg_username", "courserun_readable_id"]

- name: __micromasters_course_grades_dedp_from_micromasters
  description: DEDP course grades from MicroMasters database
  columns:
  - name: program_title
    description: str, title of program the course is part of
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run ID on edX.org
    tests:
    - not_null
  - name: courserun_platform
    description: str, indicating the platform where this course runs on. It's either
      mitxonline or edxorg.
    tests:
    - not_null
  - name: course_number
    description: str, unique string for the course e.g. 14.009x
    tests:
    - not_null
  - name: user_edxorg_username
    description: str, username on edX.org
  - name: user_mitxonline_username
    description: str, username on MITxOnline
  - name: user_email
    description: str, user email on edX.org
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on edX.org
  - name: user_country
    description: str, user country on edX.org
  - name: coursegrade_grade
    description: float, course grade on edX.org range from 0 to 1
    tests:
    - not_null
  - name: coursegrade_created_on
    description: timestamp, date and time when this grade was initially calculated
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_email", "courserun_readable_id"]
  - dbt_expectations.expect_table_row_count_to_equal_other_table:
      compare_model: ref('stg__micromasters__app__postgres__grades_combinedcoursegrade')


- name: __micromasters_course_grades_dedp_from_mitxonline
  description: DEDP course grades on MITx Online
  columns:
  - name: program_title
    description: str, title of program the course is part of
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run ID on MITx Online
    tests:
    - not_null
  - name: courserun_platform
    description: str, indicating the platform where this course runs on. It's either
      mitxonline or edxorg. edxorg runs were migrated from MicroMasters.
    tests:
    - not_null
  - name: course_number
    description: str, unique string for the course e.g. 14.009x
    tests:
    - not_null
  - name: user_edxorg_username
    description: str, username on edX.org
  - name: user_mitxonline_username
    description: str, username on MITxOnline
    tests:
    - not_null
  - name: user_email
    description: str, user email on MITx Online
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on MITx Online
  - name: user_country
    description: str, user country on MITx Online
  - name: courserungrade_grade
    description: float, course grade range from 0 to 1
    tests:
    - not_null
  - name: courserungrade_is_passing
    description: boolean, indicating whether the user has passed the passing score
      set for this course on MITxOnline
    tests:
    - not_null
  - name: courserungrade_created_on
    description: timestamp, date and time when this grade was initially calculated
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_mitxonline_username", "courserun_readable_id"]

- name: __micromasters_course_grades_non_dedp_from_edxorg
  description: Non-DEDP program course certificates on edX.org
  columns:
  - name: program_title
    description: str, title of program the course is part of
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run ID on edX.org
    tests:
    - not_null
  - name: courserun_platform
    description: str, indicating the edx.org platform where this course runs on
    tests:
    - not_null
  - name: course_number
    description: str, unique string for the course e.g. 14.009x
    tests:
    - not_null
  - name: user_edxorg_username
    description: str, username on edX.org
    tests:
    - not_null
  - name: user_mitxonline_username
    description: str, username on MITxOnline
  - name: user_email
    description: str, user email on edX.org
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on edX.org
  - name: user_country
    description: str, user country on edX.org
  - name: courserungrade_user_grade
    description: float, course grade range from 0 to 1, maybe blank
  - name: courserungrade_is_passing
    description: boolean, indicating whether the user has passed the passing score
      set for this course on edX.org
    tests:
    - not_null
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_edxorg_username", "courserun_readable_id"]
