---
version: 2

models:
- name: int__mitx__users
  description: Intermediate model for MITx users from MITx Online and edX.org
  columns:
  - name: platform
    description: string, application where the data is from
    tests:
    - not_null
    - accepted_values:
        values: '{{ var("platforms") }}'
  - name: user_id
    description: int, user ID on the corresponding platform - MITx Online or edX.org
    tests:
    - not_null
  - name: user_username
    description: string, username on the corresponding platform - MITx Online or edX.org
    tests:
    - not_null
  - name: user_email
    description: string, user email on the corresponding platform - MITx Online or
      edX.org
    tests:
    - not_null
  - name: user_address_country
    description: str, country code provided by the user on the corresponding platform
      - MITx Online or edX.org
  - name: user_highest_education
    description: str, user's level of education
  - name: user_gender
    description: str, Gender selected by the user on their profile on the corresponding
      platform
  - name: user_birth_year
    description: int, user's birth year
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_id", "platform"]

- name: int__mitx__courserun_enrollments
  description: MITx courserun enrollments combined from MITx Online and edX.org
  columns:
  - name: platform
    description: string, indicating application where the data is from. It's either
      MITx Online or edX.org
    tests:
    - not_null
    - accepted_values:
        values: ["MITx Online", "edX.org"]
  - name: courserunenrollment_is_active
    description: boolean, indicating whether the user is still enrolled in the run
    tests:
    - not_null
  - name: courserunenrollment_created_on
    description: timestamp, specifying when an enrollment was initially created
    tests:
    - not_null
  - name: courserunenrollment_enrollment_mode
    description: str, enrollment mode for MITx courses. DEDP enrollments are verified
      in either MITx Online or MicroMasters orders. For DEDP runs on edX.org or DEDP
      runs on MITx Online in '3T2021', '1T2022', '2T2022', these are paid and verified
      in MicroMasters. For other DEDP courses that run on MITx Online, they are paid
      and verified in MITx Online
    tests:
    - not_null
  - name: courserunenrollment_enrollment_status
    description: str, enrollment status for users whose enrollment changed. Only applicable
      for MITx Online, In MITx Online options are 'deferred', 'transferred', 'refunded',
      'enrolled', 'unenrolled', maybe blank
    tests:
    - accepted_values:
        values: ['deferred', 'transferred', 'refunded', 'unenrolled']
  - name: user_id
    description: int, user ID on the corresponding platform - MITx Online or edX.org
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run ID on edX.org or MITxOnline. Open edX Course ID formatted
      as course-v1:{org}+{course code}+{run_tag}
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run, maybe blank for some edX.org runs
  - name: user_email
    description: str, user email associated with their account
    tests:
    - not_null
  - name: user_mitxonline_username
    description: str, username on MITx Online if user's account is linked on MicroMasters
      portal
  - name: user_edxorg_username
    description: str, username in edx.org. For the very small number of users with
      multiple edx usernames, this is the username with the latest logins
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_email", "courserun_readable_id"]
