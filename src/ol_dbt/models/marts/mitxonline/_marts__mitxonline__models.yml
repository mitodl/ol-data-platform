---
version: 2

models:
- name: marts__mitxonline_course_certificates
  description: course certificates from MITx Online app
  config:
    grants:
      select: ['mit_irx']
  columns:
  - name: course_number
    description: str, unique string for the course. It can contain letters, numbers,
      or periods. e.g. 6.002.1x
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run readable ID for MITx Online courses
    tests:
    - not_null
  - name: courseruncertificate_url
    description: str, URL to the certificate on MITx Online
    tests:
    - not_null
  - name: courseruncertificate_created_on
    description: timestamp, date and time when this course certificate was initially
      created
    tests:
    - not_null
  - name: user_username
    description: str, username on MITx Online
    tests:
    - not_null
  - name: user_email
    description: str, user email on MITx Online
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on MITx Online
    tests:
    - not_null
  - name: openedx_user_id
    description: int, foreign key to open edX users. Not all app users have openedx_user_id
      due to username mismatch between app and open edX.

- name: marts__mitxonline_user_profiles
  description: MITx Online user profiles
  config:
    grants:
      select: ['mit_irx']
  columns:
  - name: user_username
    description: str, username on MITx Online
    tests:
    - unique
    - not_null
  - name: user_full_name
    description: str, full name on MITx Online
    tests:
    - not_null
  - name: user_email
    description: str, email on MITx Online
    tests:
    - unique
    - not_null
  - name: user_address_country
    description: str, country code for the user's address
  - name: user_address_state
    description: str, state code for the user's address
  - name: user_birth_year
    description: int, user birth year
  - name: user_gender
    description: str, user gender
    tests:
    - accepted_values:
        values: '{{ var("gender_values") }}'
  - name: user_highest_education
    description: str, user highest education
    tests:
    - accepted_values:
        values: '{{ var("highest_education_values") }}'

- name: marts__mitxonline_course_enrollments
  description: learners MITx Online course enrollments and demographics
  columns:
  - name: course_number
    description: str, unique string for the course. It can contain letters, numbers,
      or periods. e.g. 6.002.1x
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, course run readable ID for MITx Online courses
    tests:
    - not_null
  - name: courserunenrollment_is_active
    description: boolean, indicating whether the user is still enrolled in the run
    tests:
    - not_null
  - name: courserunenrollment_created_on
    description: timestamp, specifying when an enrollment was initially created
    tests:
    - not_null
  - name: courserunenrollment_enrollment_mode
    description: str, enrollment mode for MITx courses. DEDP enrollments are verified
      in either MITx Online or MicroMasters orders. For DEDP runs on edX.org or DEDP
      runs on MITx Online in '3T2021', '1T2022', '2T2022', these are paid and verified
      in MicroMasters. For other DEDP courses that run on MITx Online, they are paid
      and verified in MITx Online
    tests:
    - not_null
  - name: courserunenrollment_enrollment_status
    description: str, enrollment status for users whose enrollment changed. Only applicable
      for MITx Online, In MITx Online options are 'deferred', 'transferred', 'refunded',
      'enrolled', 'unenrolled', maybe blank
  - name: user_email
    description: str, user email on MITx Online
    tests:
    - not_null
  - name: user_username
    description: str, username on MITx Online
    tests:
    - not_null
  - name: user_full_name
    description: str, user full name on MITxOnline
    tests:
    - not_null
  - name: user_address_country
    description: str, country code in user's profile on MITx Online
  - name: user_highest_education
    description: str, user's level of education in user's profile on MITx Online
  - name: user_gender
    description: str, user's gender in user's profile on MITx Online
  - name: user_birth_year
    description: int, user's birth year in user's profile on MITx Online
  - name: user_company
    description: str, user's company in user's profile on MITx Online
  - name: user_job_title
    description: str, user's job title in user's profile on MITx Online
  - name: user_industry
    description: str, user's job industry in user's profile on MITx Online
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["user_username", "courserun_readable_id"]


- name: marts__mitxonline_weekly_course_engagements
  description: Weekly time series of MITx Online learners course engagement statistics
  columns:
  - name: week_start_date
    description: date, week starting date for this aggregate statistics. In this report,
      it starts on every Sunday.
    tests:
    - not_null
  - name: week_end_date
    description: date, week ending date for this aggregate statistics. In this report,
      it ends on every Saturday.
    tests:
    - not_null
  - name: courserun_readable_id
    description: str, Open edX Course ID formatted as course-v1:{org}+{course code}+{run_tag}.
    tests:
    - not_null
  - name: course_number
    description: str, unique string for the course. It can contain letters, numbers,
      or periods. e.g. 18.03.1x
    tests:
    - not_null
  - name: courserun_title
    description: str, title of the course run
  - name: courserun_start_on
    description: timestamp, datetime on when the course begins
  - name: courserun_end_on
    description: timestamp, datetime on when the course ends
  - name: unique_users
    description: int, number of unique users who engaged in any type of course activity
  - name: unique_submitted_problem_users
    description: int, number of unique users who submitted an answer for a problem
  - name: unique_watched_video_users
    description: int, number of unique users who watched any course video.
  - name: unique_participated_discussion_users
    description: int, number of unique users who created a post, response, or comment
      to any course discussion.
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["week_start_date", "courserun_readable_id"]
