---
version: 2
models:
- name: program_summary_report
  description: MITx and xPro Program Summary report. A count of all users, enrollments
    (audit and verified), certificates and program credentials aggregated for each
    program.
  columns:
  - name: program_name
    description: str, name of the program. If program is split over multiple tracks,
      the program name is the same for all tracks. e.g. Data, Economics, and Design
      of Policy
    tests:
    - not_null
  - name: total_enrollments
    description: int, count of course enrollments in the program, aggregated by user_email
      and courserun_readable_id
    tests:
    - not_null
  - name: unique_users
    description: int, count of unique users who took courses in the program, aggregated
      by user_email
    tests:
    - not_null
  - name: unique_countries
    description: int, count of unique countries of enrolled users, aggregated by user_email
    tests:
    - not_null
  - name: verified_enrollments
    description: int, count of verified (paid) enrollments in the program's courses,
      aggregated by user_email and courserun_readable_id
    tests:
    - not_null
  - name: unique_verified_users
    description: int, count of unique verified users enrolled in the program's courses,
      aggregated by user_email
    tests:
    - not_null
  - name: course_certificates
    description: int, count of course certificate earned for the courses in the program,
      aggregated by user_email and courserun_readable_id
    tests:
    - not_null
  - name: unique_course_certificate_earners
    description: int, count of unique users who earned a certificate for one of the
      program's courses, aggregated by user_email
    tests:
    - not_null
  - name: program_certificates
    description: int, count of program certificates earned for each program, aggregated
      by user_email. If a user gets the Statistics and Data Science program certificate
      in both the General and Social Sciences tracks, it would be counted as one program
      certificate.

- name: learner_engagement_report
  description: Engagement report by learner, course, courserun, section and subsection.
    A count of posts replied, posts created, average percent grade, percent problems
    attempted, number of problems, problems attempted, video duration, estimated time
    played, and number of page views.
  columns:
  - name: platform
    description: str, name of the platform
  - name: user_email
    description: str, user email associated with their account on the corresponding
      platform
  - name: course_title
    description: str, title of the course.
  - name: courserun_readable_id
    description: string, unique string to identify a course run on the corresponding
      platform.
  - name: section_title
    description: str, title of the section within the course
  - name: subsection_title
    description: str, title of the subsection within the course
  - name: num_of_page_views
    description: int, num of times the user viewed a page
  - name: estimated_time_played
    description: int, seconds that a user played a video
  - name: video_duration
    description: int, duration of the video in seconds
  - name: problems_attempted
    description: int, count of problems attempted
  - name: number_of_problems
    description: int, total number of problems regardless of whether they were attempted
  - name: percetage_problems_attempted
    description: str, count of problems attempted/ total number of problems
  - name: avg_percent_grade
    description: str, average grade the learner recieved
  - name: posts_created
    description: int, count of discussion posts created
  - name: posts_replied
    description: int, count of discussion posts replied to

- name: enrollment_detail_report
  description: Enrollment detail report for MITxOnline, xPro and edX.org courses.
    A detailed view of enrollments, course runs, course certificates, orders, and
    user information for each enrollment.
  columns:
  - name: platform
    description: string, application where the data is from
    tests:
    - not_null
  - name: courserunenrollment_id
    description: int, internal ID and foreign key to courserunenrollments on the corresponding
      platform. Null for enrollments on edX.org.
  - name: course_readable_id
    description: str, Open edX ID formatted as course-v1:{org}+{course code} for MITx
      Online, xPro or Residential courses, and {org}/{course} for edX.org courses.
      May be null for some Bootcamps courses. Examples include MITx/6.00.2x and course-v1:MITxT+14.740x.
  - name: course_title
    description: str, title of the course. May be null for some edX.org and Residential
      courses
  - name: courserun_is_current
    description: boolean, indicating if the course run is currently running. True
      if courserun_start_on is in the past and blank courserun_end_on, or courserun_start_on
      is in the past and courserun_end_on is in the future.
  - name: courserun_readable_id
    description: str, Open edX course ID formatted as course-v1:{org}+{course code}+{run_tag}
      for MITxOnline and xPro courses, {org}/{course}/{run_tag} for edX.org courses
  - name: courserun_start_on
    description: timestamp, date and time when the course run starts. May be Null.
  - name: courserun_end_on
    description: timestamp, date and time when the course run ends. May be Null.
  - name: courserun_title
    description: string, title of the course run on the corresponding platform. Maybe
      blank for a few edX.org runs missing in int__edxorg__mitx_courseruns.
  - name: courserunenrollment_created_on
    description: timestamp, specifying when the enrollment was initially
    tests:
    - dbt_expectations.expect_column_values_to_not_be_null:
        row_condition: "platform != 'xPRO Global Alumni'"
  - name: courserunenrollment_enrollment_mode
    description: string, enrollment mode for user on the corresponding platform
  - name: courserunenrollment_enrollment_status
    description: string, enrollment status for users whose enrollment changed on the
      corresponding platform
  - name: courserunenrollment_is_active
    description: boolean, indicating whether the enrollment is active
  - name: courserunenrollment_upgraded_on
    description: timestamp, date and time when the learner upgraded to the verified
      track course mode. May be the same as the date when the course enrollment was
      created for xPro.
  - name: courseruncertificate_created_on
    description: timestamp, date and time when the course certificate was initially
      created
  - name: courseruncertificate_is_earned
    description: boolean, indicating if learner has earned the certificate on mitxonline.mit.edu,
      edX.org or xpro.mit.edu.
    tests:
    - not_null
  - name: courseruncertificate_url
    description: str, URL to the course certificate for users who earned the certificate
      on mitxonline.mit.edu, edX.org or xpro.mit.edu.
  - name: courserungrade_grade
    description: float, course grade on edX.org or MITxOnline or xPro range from 0
      to 1
  - name: courserungrade_is_passing
    description: boolean, indicating whether the user has passed the passing score
      set for this course on edX.org or MITxOnline or xPro
  - name: user_country_code
    description: str, country code on the platform user enrolled. May be blank.
  - name: user_highest_education
    description: str, user's level of education
  - name: user_full_name
    description: str, user full name on the platform user enrolled.
  - name: user_username
    description: string, username to identify a user on the corresponding platform.
      Null for all the xPRO Emeritus.
  - name: user_email
    description: string, user email that user registered on the corresponding platform.
      May be null for some xPRO Emeritus learners.
  - name: num_of_course_passed
    description: number, the number of courses learner passed based on their emails
      so this counts as same person if they use the email to register on different
      platforms
  - name: coupon_code
    description: string, discount code for the redeemed coupon if applicable
  - name: coupon_name
    description: string, human readable name for the coupon payment
  - name: discount
    description: str, discount applied to the order in a readable format. The value
      is always an amount taken off the list price of the order, e.g., "$100" means
      $100 was taken off the price. "30%" means the price was reduced by 30%.
  - name: order_id
    description: int, foreign key to ecommerce order table for fulfilled or refunded
      orders on the corresponding platform. Note that this does not include orders
      from edX.org, for which we do not have data.
  - name: order_reference_number
    description: string, order reference number to identify a fulfilled or refunded
      order on the corresponding platform, e.g. mitxonline-production-20
  - name: order_state
    description: string, order state. Options are "cancelled", "created", "declined",
      "errored", "failed", "fulfilled", "refunded", "partially_refunded",  "pending",
      "review".
  - name: order_created_on
    description: timestamp, specifying when the order was initially created. If this
      is a b2b order it will be the timestamp that order was created otherwise it
      will be when the regular order was created. For edX.org, it is the timestamp
      that order was created in MicroMasters application.
  - name: receipt_payment_amount
    description: numeric, total amount for the order - req_amount from cybersource
      payment
  - name: receipt_payment_method
    description: string, payment method from cybersource payment transaction. Value
      could be 'paypal' or 'card'.
  - name: receipt_payment_timestamp
    description: string, the signed_date_time from cybersource payment transaction
  - name: receipt_payer_email
    description: string, payer email address from cybersource payment transaction
  - name: unit_price
    description: numeric, price for the order line item before discount
  - name: program_name
    description: string, name of the program the course belongs to
  - name: receipt_url
    description: string, URL to the receipt for the order on the MITx Online application

- name: video_engagement_report
  description: Learners video engagement - play, pause, seek, or stop video actions
    from MITx Online, xPro, edX.org, Residential MITx with calculated counts for total
    video events, distinct videos watched, and max video index.
  columns:
  - name: user_email
    description: str, user email on the corresponding platform
  - name: chapter_title
    description: str, title of chapter this video belongs to. Null for Residential
      MITx until we populate the course structure data.
  - name: courserun_readable_id
    description: str, the open edX course ID formatted as course-v1:{org}+{course
      code}+{run_tag} for MITxOnline, xPro, Residential courses, {org}/{course}/{run_tag}
      for edX.org courses.
    tests:
    - not_null
  - name: total_video_count
    description: int, the total number of distinct videos for a chapter and courserun.
  - name: platform
    description: str, open edx platform, e.g., MITx Online, edX.org, xPro, Residential
      MITx.
    tests:
    - not_null
  - name: courserun_is_current
    description: boolean, indicating if the course run is currently running. True
      if courserun_start_on is in the past and blank courserun_end_on, or courserun_start_on
      is in the past and courserun_end_on is in the future.
  - name: course_readable_id
    description: str, Open edX ID formatted as course-v1:{org}+{course code} for MITx
      Online, xPro or Residential courses, {org}/{course} for edX.org courses.
  - name: user_watched_video_count
    description: int, The number of distinct videos the user watched in the course
  - name: max_video_index
    description: int, The maximum sequence number giving order in which this block
      content appears within the course.

- name: cheating_detection_report
  description: Problem and grade information that is associated with a particular
    course run, platform, and learner that is used for cheating detection analysis.
  columns:
  - name: platform
    description: str, open edx platform, e.g., MITx Online, edX.org, xPro, Residential
      MITx.
  - name: openedx_user_id
    description: int, user ID on the corresponding open edX platform
  - name: courserun_readable_id
    description: string, foreign key to dim_course_content, referencing the edX course
      run ID
  - name: problem_block_fk
    description: string, foreign key referencing the problem block ID in the dim_course_content
      table, formatted as block-v1:{org}+{course}+{run}type@problem@{hash code}.
  - name: unit_name
    description: string, title of the course content block. It is the name field for
      the unit on the Studio 'Course Outline' page.
  - name: chapter_name
    description: string, title of the course content block. It is the name field for
      the chapter.
  - name: sequential_name
    description: string, title of the course content block. It is the name field for
      the sequential.
  - name: exam_indicator
    description: boolean, If the name field for the unit on the Studio 'Course Outline'
      page contains the word 'exam' then this is true otherwise it's false.
  - name: hw_indicator
    description: boolean, If the name field for the unit on the Studio 'Course Outline'
      page contains the word 'homework' then this is true otherwise it's false.
  - name: max_possible_grade
    description: number, maximum possible grade value for the problem
  - name: attempts_on_problem
    description: int, max attempt number generated when parsing answer submissions
  - name: max_learner_grade
    description: number, max of how many responses the learner got right within the
      problem.
  - name: grades
    description: number, current values indicating the total unweighted grades for
      this problem that the learner has scored. e.g. how many responses they got right
      within the problem. This data is also available in courseactivity_problemcheck
  - name: time_spent_on_problem
    description: string, the estimated amount of time spent on a problem. It cannot
      exceed 600 seconds or it will be null.
  - name: time_spent_on_problem_nolimit
    description: string, the estimated amount of time spent on a problem.
  - name: courserungrade_grade
    description: float, course grade on edX.org or MITxOnline or xPro range from 0
      to 1
  - name: user_avg_hw_grade
    description: number, avg of grades the learner got for all homework problems
  - name: user_avg_exam_grade
    description: number, avg of grades the learner got for all exam problems
  - name: user_hw_median_solving_time
    description: string, the estimated median amount of time the learner spent on
      all homework problems.
  - name: user_exam_median_solving_time
    description: string, the estimated median amount of time the learner spent on
      all exam problems.
  - name: user_hw_attempts_on_problem
    description: int, total learner attempts generated when parsing answer submissions
      on homework problems
  - name: user_exam_time_flags
    description: int, total times a learner gets a performance time flag when their
      exam problem solving time was below the 10th percentile of time taken by all
      students to solve an exam problem
  - name: non_exam_problem_count
    description: int, count of non-exam problems the learner attempted in the course
  - name: user_taken_final_exam
    description: boolean, true if the learner has taken the final exam in the course
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["platform", "openedx_user_id", "courserun_readable_id", "problem_block_fk"]

- name: chatbot_usage_report
  description: AI chatbot interactions from Learn AI application including TutorBot,
    ResourceRecommendationBot, SyllabusBot and VideoGPTBot. No personal information
    is included in this report.
  columns:
  - name: ai_agent
    description: str, indicates the type of chatbot agent used in the session. Possible
      values - TutorBot, ResourceRecommendationBot, VideoGPTBot, SyllabusBot
    tests:
    - not_null
  - name: thread_id
    description: str, unique identifier for the chat thread.
    tests:
    - not_null
  - name: resource_id
    description: str, course ID, video transcript asset ID, or edX module ID depending
      on the ai_agent. May be blank for ResourceRecommendationBot.
  - name: human_message
    description: str, the human message
  - name: agent_message
    description: str, the agent message
  - name: message_index
    description: int, the order of the message in the chat session.
  - name: created_on
    description: timestamp, date and time when the chat session was created.

- name: organization_administration_report
  description: A report showing certificates/completions for later roll-up at the
    organizational level.
  columns:
  - name: courserun_readable_id
    description: string, unique string to identify a course run
  - name: user_email
    description: string, user email that user registered
  - name: enrolled_count
    description: int, a count of 1 means the learner enrolled otherwise 0
  - name: organization_key
    description: str, key of the organization that lists the course. e.g. MITx, MITxT,
      null
  - name: organization_name
    description: str, name of the organization that lists the course.
  - name: activity_date
    description: date, date the user engaged in an activity
  - name: chatbot_used_count
    description: int, a count of 1 if the user engaged with a chatbot otherwise 0
  - name: certificate_count
    description: int, a count of 1 if the user earned a certificate that day otherwise
      0
  - name: videos_watched
    description: int, a count of 1 if the user watched a video otherwise 0
  - name: problems_count
    description: int, a count of 1 if the user tried a problem otherwise 0
  - name: active_count
    description: int, a count of 1 if the user engaged with the course otherwise 0
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["courserun_readable_id", "organization_key", "user_email", "activity_date"]

- name: instructor_module_report
  description: A report showing chatbot data for later roll-up at the instructor level.
  columns:
  - name: user_email
    description: string, user email that user registered
  - name: activity_date
    description: date, date the user engaged in an activity
  - name: courserun_readable_id
    description: string, unique string to identify a course run
  - name: chatbot_used_count
    description: int, a count of how many times the user engaged with a chatbot
  - name: block_category
    description: string, category/type of the content block. Possible values are course,
      chapter, sequential, vertical, discussion, html, problem, video, etc.
  - name: block_title
    description: string, title of the course content block. It is the name field for
      the section, subsection, or unit on the Studio 'Course Outline' page.
  - name: section_title
    description: string, title of the course content block. It is the name field for
      the section.
  - name: subsection_title
    description: string, title of the course content block. It is the name field for
      the subsection.
  - name: chatbot_type
    description: string, type of the chatbot. e.g. Syllabus, Tutor, etc.
  - name: estimated_time_played
    description: int, estimated video seconds played
  - name: video_duration
    description: int, legth of the video in seconds
  - name: rewatch_indicator
    description: boolean, true if the learner is rewatching the video
  - name: video_watched_count
    description: int, count of videos watched
  - name: enrolled_indicator
    description: boolean, true if courserunenrollment_enrollment_status is null else
      false
  - name: ever_active_indicator
    description: boolean, true if user had any video, problem, navigation, discussion,
      chatbot , unique_course_certificate_earners otherwise false

- name: mitxonline_video_engagements_w_video_counts
  description: A report that contains mitxonline video engagement data.
  columns:
  - name: user_email
    description: string, user email that user registered
  - name: section_title
    description: string, title of the course content block. It is the name field for
      the section.
  - name: courserun_readable_id
    description: string, unique string to identify a course run on the corresponding
      platform.
  - name: total_video_count
    description: int, count of videos within a course run and course section
  - name: platform
    description: string, the platform name currently defaulted to MITx Online
  - name: courserun_is_current
    description: boolean, true if the current date is between the course run start
      and end dates otherwise false
  - name: user_watched_video_count
    description: int, count of videos a user watched
  - name: max_coursestructure_block_index
    description: int, max position of the course content block within a course
  tests:
  - dbt_expectations.expect_compound_columns_to_be_unique:
      column_list: ["courserun_readable_id", "user_email", "section_title"]
